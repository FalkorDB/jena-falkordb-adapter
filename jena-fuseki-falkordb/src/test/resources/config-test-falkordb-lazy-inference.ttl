# FalkorDB Fuseki Test Configuration with Lazy Inference (Backward Chaining Rules)
#
# This configuration file is used for testing lazy inference rules with FalkorDB
# backend. It applies the friend_of_friend inference rules using backward chaining.
# Backward chaining (lazy inference) computes inferences on-demand when queried.

@prefix :        <#> .
@prefix falkor:  <http://falkordb.com/jena/assembler#> .
@prefix fuseki:  <http://jena.apache.org/fuseki#> .
@prefix ja:      <http://jena.hpl.hp.com/2005/11/Assembler#> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .

# Declare FalkorDBModel as a subclass of ja:Model for assembler compatibility
falkor:FalkorDBModel rdfs:subClassOf ja:Model .

# Fuseki server configuration
[] rdf:type fuseki:Server ;
   fuseki:services (
     :service
   ) .

# The FalkorDB-backed service with lazy inference
:service rdf:type fuseki:Service ;
    fuseki:name "testdb" ;
    
    fuseki:endpoint [
        fuseki:operation fuseki:query ;
        fuseki:name "sparql"
    ] ;
    fuseki:endpoint [
        fuseki:operation fuseki:query ;
        fuseki:name "query"
    ] ;
    fuseki:endpoint [
        fuseki:operation fuseki:update ;
        fuseki:name "update"
    ] ;
    fuseki:endpoint [
        fuseki:operation fuseki:gsp-r ;
        fuseki:name "get"
    ] ;
    fuseki:endpoint [
        fuseki:operation fuseki:gsp-rw ;
        fuseki:name "data"
    ] ;
    
    fuseki:dataset :dataset_rdf .

# RDF Dataset wrapping the inference model
:dataset_rdf rdf:type ja:RDFDataset ;
    ja:defaultGraph :model_inf .

# Inference model with Generic Rule Reasoner using backward chaining (lazy inference)
:model_inf rdf:type ja:InfModel ;
    ja:baseModel :falkor_db_model ;
    ja:reasoner [
        ja:reasonerURL <http://jena.hpl.hp.com/2003/GenericRuleReasoner> ;
        ja:rulesFrom <file:rules/friend_of_friend_bwd.rule> ;
    ] .

# FalkorDB-backed model configuration
:falkor_db_model rdf:type falkor:FalkorDBModel ;
    falkor:host "localhost" ;
    falkor:port 6379 ;
    falkor:graphName "test_lazy_inference_graph" .
